<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dhuruvan Logistics Tracking</title>
<style>
    body { font-family: Arial, sans-serif; background: #f3f3f3; margin: 0; padding: 20px; }
    .container { max-width: 500px; margin: auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
    input, button { width: 100%; padding: 12px; margin-top: 12px; font-size: 16px; }
    button { background: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    .result { margin-top: 20px; padding: 15px; background: #e8ffe6; border-left: 4px solid green; }
    .error { margin-top: 20px; padding: 15px; background: #ffe6e6; border-left: 4px solid red; }
</style>
</head>

<body>
<div class="container">
    <h2>Dhuruvan Logistics â€“ Tracking</h2>

    <input id="lrInput" type="text" placeholder="Enter LR Number (Example: DL-45)" />
    <button onclick="track()">Track Shipment</button>

    <div id="output"></div>
</div>

<script>
const sheetID = "1JEC5Ls30AK7bIIuNgfA_oIpRONPb3FLbe1On-PQeXk0";
const sheetGID = "1342163903";

function track() {
    const lr = document.getElementById("lrInput").value.trim().toUpperCase();
    const output = document.getElementById("output");

    if (!lr) {
        output.innerHTML = "<div class='error'>Please enter LR Number.</div>";
        return;
    }

    output.innerHTML = "Loading...";

    const url =
      https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:csv&gid=${sheetGID};

    fetch(url)
        .then(res => res.text())
        .then(csv => {
            const rows = csv.split("\n").map(r => r.split(","));
            const headers = rows[0];

            // Identify column positions
            const lrCol = headers.indexOf("LR Normalized");
            const consignorCol = headers.indexOf("Consignor Name");
            const consigneeCol = headers.indexOf("Consignee Name");
            const pickupCol = headers.indexOf("Pickup Location");
            const deliveryCol = headers.indexOf("Delivery Location");
            const mobileCol = headers.indexOf("Mobile Number");
            const statusCol = headers.indexOf("Current Status");
            const commentsCol = headers.indexOf("Comments");

            let found = false;

            for (let i = 1; i < rows.length; i++) {
                const row = rows[i].map(r => r.replace(/"/g, "").trim());

                if (row[lrCol] === lr) {
                    found = true;
                    output.innerHTML = `
                        <div class='result'>
                            <b>LR Number:</b> ${lr}<br><br>
                            <b>Consignor:</b> ${row[consignorCol]}<br>
                            <b>Consignee:</b> ${row[consigneeCol]}<br>
                            <b>Pickup:</b> ${row[pickupCol]}<br>
                            <b>Delivery:</b> ${row[deliveryCol]}<br>
                            <b>Mobile:</b> ${row[mobileCol]}<br>
                            <b>Status:</b> ${row[statusCol]}<br>
                            <b>Comments:</b> ${row[commentsCol]}
                        </div>`;
                    break;
                }
            }

            if (!found) {
                output.innerHTML = "<div class='error'>LR Number not found. Please check again.</div>";
            }
        })
        .catch(() => {
            output.innerHTML = "<div class='error'>Error loading data. Please try again later.</div>";
        });
}
</script>

</body>
</html>